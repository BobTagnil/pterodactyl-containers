#@ load("@ytt:data", "data")

#@ def daemon_service():
daemon:
  #! Optional build settings can be enabled
  #@ if/end data.values.docker.build == True:
  build:
    args:
      VERSION: ${DAEMON_VERSION}
    context: ./manifest/images/daemon
  #@yaml/text-templated-strings
  image: (@= data.values.daemon.image @)
  ports:
  #@yaml/text-templated-strings
  - (@= data.values.daemon.network.ip_addr @):(@= str(data.values.daemon.network.ports.sftp) @):(@= str(data.values.daemon.network.ports.sftp) @)
  #@yaml/text-templated-strings
  - (@= data.values.daemon.network.ip_addr @):(@= str(data.values.daemon.network.ports.http) @):(@= str(data.values.daemon.network.ports.http) @)
  privileged: true
  restart: always
  volumes:
  - ./conf.d/daemon:/etc/pterodactyl
  - ./conf.d/certs:/etc/certs:ro
  - ./data/letsencrypt:/etc/letsencrypt:ro
  #@yaml/text-templated-strings
  - (@= data.values.daemon.volumes.root @):(@= data.values.daemon.volumes.root @)
  #@yaml/text-templated-strings
  - (@= data.values.daemon.volumes.volumes @):(@= data.values.daemon.volumes.volumes @)
  #@yaml/text-templated-strings
  - (@= data.values.daemon.volumes.backup @):(@= data.values.daemon.volumes.backup @)
  #@yaml/text-templated-strings
  - (@= data.values.docker.socket @):(@= data.values.docker.socket @)

  - /tmp/pterodactyl/:/tmp/pterodactyl/
  #@yaml/text-templated-strings
  working_dir: (@= data.values.daemon.volumes.root @)
#@ end