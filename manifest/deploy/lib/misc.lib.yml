#@ load("@ytt:data", "data")

#! Misc Services provided for deployment. 

#! == Job Scheduler ==
#!
#! This service uses ofelia, which allows
#! jobs to be executed within docker. 
#!
#@ def cron_service():
cron:
  command: daemon --config=/etc/jobs/jobs.ini
  image: docker.io/mcuadros/ofelia:latest
  network_mode: none
  privileged: true
  restart: always
  volumes:
  - ./data/cron:/etc/jobs:ro
  #@yaml/text-templated-strings
  - (@= data.values.docker.socket @):/var/run/docker.sock
#@ end

#! == Let's Encrypt Certbot ==
#!
#!
#@ def certbot_service():
certbot:
  command: renew
  image: docker.io/certbot/certbot:latest
  #@ if/end data.values.panel.enabled == False:
  ports:
  - 80:80
  - 443:443
  volumes:
  - ./data/letsencrypt:/etc/letsencrypt
#@ end